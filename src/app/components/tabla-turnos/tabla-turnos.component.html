<label class="form-label select-label">Seleccione paciente</label>
<select class="select" formControlName="pacienteSeleccionado" id="pacienteSeleccionado">
   <option *ngFor="let paciente of turnos | async | obtenerPacientes: usuario?.mail : '0' : false" value={{paciente}}>{{paciente}}</option>
</select>

<label class="form-label select-label">Seleccione profesional</label>
<select class="select" formControlName="pacienteSeleccionado" id="pacienteSeleccionado">
   <option *ngFor="let paciente of turnos | async | obtenerProfesionalPaciente: usuario?.mail" value={{paciente}}>{{paciente}}</option>
</select>

<label class="form-label select-label">Seleccione especialidad</label>
<select class="select" formControlName="especialidadSeleccionada" id="especialidadSeleccionada">
   <option *ngFor="let especialidad of turnos | async | obtenerEspecialidadProfesional:usuario?.mail"  value={{especialidad}}>{{especialidad}}</option>
</select>

<label class="form-label select-label">Seleccione palabra clave</label>
<select class="select" formControlName="palabra_clave" id="palabra_clave">
   <option *ngFor="let palabra_clave of turnos | async | obtenerPalabrasClaves: usuario?.especialidades" value={{palabra_clave}}>{{palabra_clave}}</option>
</select>

<!-- <button (click)="ObtenerDatos()"></button> -->

<!-- <label class="form-label select-label">Seleccione su especialidad</label>
<select class="select" formControlName="especialidad" id="especialidad">
    <option *ngFor="let paciente of turnos | async | obtenerPacientes" value={{paciente}}>{{paciente}}</option>
</select> -->

<h1>Turnos {{usuario?.nombre}}</h1>
<div class="table-responsive">
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th scope="col">Fecha</th>
                <th scope="col">Especialidad</th>
                <th scope="col">Profesional</th>
                <th scope="col">Paciente</th>
                <th scope="col">Estado</th>
            </tr>
        </thead>
        <tbody>
            <!-- 1 = pendienteAprobacion -->
            <ng-container *ngIf="usuario?.perfil == 'paciente'">
                <tr *ngFor="let turno of turnos | async | filtroTurnosPaciente: usuario?.mail : '' : '0' : false ">
                    <td>{{ ConvertirFecha(turno.fecha) | date:'medium' }}</td>
                    <td>{{turno.especialidad}}</td>
                    <td>{{turno.profesional}}</td>
                    <td>{{turno.paciente}}</td>
                    <td>{{turno.estado | estadoTurnos}}</td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.estado != 2 && turno.estado != 3 && turno.estado != 4 && turno.estado != 5" (click)="AbrirModal('cancelar-turno', turno)">Cancelar turno</button></td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.resena != '' " (click)="AbrirModal('ver-reseña', turno)">Ver reseña</button></td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.resena != '' && turno.estado == 4 " (click)="AbrirModal('completar-encuesta', turno)">Completar encuesta</button></td>                    
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.resena != '' && turno.estado == 4 " (click)="AbrirModal('calificar-atencion', turno)">Calificar atencion</button></td>
                </tr>
            </ng-container>

            <!-- 1 = pendienteAprobacion -->
            <ng-container *ngIf="usuario?.perfil == 'profesional'">
                <tr *ngFor="let turno of turnos | async | filtroTurnosPaciente: '' : usuario?.mail: '0' : false ">
                    <td>{{ ConvertirFecha(turno.fecha) | date:'medium' }}</td>
                    <td>{{turno.especialidad}}</td>
                    <td>{{turno.profesional}}</td>
                    <td>{{turno.paciente}}</td>
                    <td>{{turno.estado | estadoTurnos}}</td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.estado != 2 && turno.estado != 3 && turno.estado != 4 && turno.estado != 5" (click)="AbrirModal('cancelar-turno', turno)">Cancelar turno</button></td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.estado == 1 " (click)="AbrirModal('rechazar-turno', turno)">Rechazar turno</button></td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.estado == 1 " (click)="AbrirModal('aceptar-turno', turno)">Aceptar turno</button></td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.estado == 3 " (click)="AbrirModal('finalizar-turno', turno)">Finalizar turno</button></td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.resena != '' " (click)="AbrirModal('ver-resena', turno)">Ver reseña</button></td>
                </tr>
            </ng-container>

            <!-- 1 = pendienteAprobacion -->
            <ng-container *ngIf="usuario?.perfil == 'administrador'">
                <tr *ngFor="let turno of turnos | async | filtroTurnosPaciente: '' : '' : '0' : false ">
                    <td>{{ ConvertirFecha(turno.fecha) | date:'medium' }}</td>
                    <td>{{turno.especialidad}}</td>
                    <td>{{turno.profesional}}</td>
                    <td>{{turno.paciente}}</td>
                    <td>{{turno.estado | estadoTurnos}}</td>
                    <td><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" *ngIf="turno.estado != 2 && turno.estado != 3 && turno.estado != 4 && turno.estado != 5" (click)="AbrirModal('cancelar-turno', turno)">Cancelar turno</button></td>
                </tr>
            </ng-container>
        </tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div> -->
      <div class="modal-body">
        <app-completar-encuesta [turnoRecibido]="turno" *ngIf="formularioSeleccionado == 'completar-encuesta'"></app-completar-encuesta>
        <app-calificar-atencion [turnoRecibido]="turno" *ngIf="formularioSeleccionado == 'calificar-atencion'"></app-calificar-atencion>
        <app-cancelar-turno [turnoRecibido]="turno" *ngIf="formularioSeleccionado === 'cancelar-turno'"></app-cancelar-turno>
        <app-ver-resena [turnoRecibido]="turno" *ngIf="formularioSeleccionado === 'ver-resena'"></app-ver-resena>
        <app-aceptar-turno [turnoRecibido]="turno" *ngIf="formularioSeleccionado === 'aceptar-turno'"></app-aceptar-turno>
        <app-rechazar-turno [turnoRecibido]="turno" *ngIf="formularioSeleccionado === 'rechazar-turno'"></app-rechazar-turno>
        <app-finalizar-turno [turnoRecibido]="turno" *ngIf="formularioSeleccionado === 'finalizar-turno'"></app-finalizar-turno>
      </div>
      <!-- <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div> -->
    </div>
  </div>
</div>